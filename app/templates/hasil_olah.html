<!DOCTYPE html>
<html lang="en">

<head>
    {% include "head.html" %}
    <!-- chart js -->
    <script src="../static/js/lib/echart/echart4/echarts.min.js"></script>
</head>

<body >
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h2 class="h1 text-center text-danger text-capitalize">Information Retrieval</h2>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="olah">
                            <div class="form-group">
                                <input type="text" class="form-control" name="query" id="query" placeholder="Enter Query">
                            </div>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                        <div class="mw-100 mh-100" style="width:900px; height:600px;" id="echartgraph"></div>
                        <script>
                            // based on prepared DOM, initialize echarts instance
                            // myChart.showLoading();
                            var myChart = echarts.init(document.getElementById('echartgraph'));
                            var node = {{ node | tojson | safe}};
                            var edge = {{ edge | tojson | safe}};
                            // console.log(node)
                            // console.log(edge)
                            // myChart.hideLoading();
                            option = {
                                title: {
                                    text: 'Graph yang terbentuk'
                                },
                                animationDuration: 1500,
                                animationEasingUpdate: 'quinticInOut',
                                series: [
                                    {
                                        type: 'graph',
                                        layout: 'none',
                                        data: node,
                                        edges: edge,
                                        // roam: true,
                                        focusNodeAdjacency: true,
                                        // itemStyle: {
                                        //     normal: {
                                        //         borderColor: '#fff',
                                        //         borderWidth: 1,
                                        //         shadowBlur: 10,
                                        //         shadowColor: 'rgba(0, 0, 0, 0.3)'
                                        //     }
                                        // },
                                        lineStyle: {
                                            color: 'source',
                                            curveness: 0.3
                                        },
                                    }
                                ]
                            };

                            myChart.setOption(option);

                            window.onresize = function () {
                                myChart.resize();
                            };
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Wrapper -->
    <!-- All Jquery -->
    {% include "script.html" %}
    <script src="../static/js/lib/datatables/datatables.min.js"></script>
    <!-- for testing echart responsive on load -->
    <script>
        // new LazyLoad();
        var myLazyLoad = new LazyLoad({
            elements_selector: "img"
        });
        
        
        function loadtabel(params) {
                $.fn.dataTable.ext.errMode = 'none'; //disable error message, use throw or alert (default) to see the error
                var t = $('#tabletesload').DataTable({                                      
                    destroy: true, //destroy every new load cause reinitializing
                    ajax: {
                        cache: true, //disable cache (please enable and view in console log to see different)
                        url: "/api/gettable/"+params,
                        dataSrc: 'nilai',
                    },
                    columns: [
                        {}, //number index columns 0
                        { data: 'kode_matkul' },
                        { data: 'kode_dosen' },
                        { data: 'nilai_AB' },
                        { data: 'nilai_CDE' },
                        { data: 'nilai_angket' },
                        { data: 'sent_neg' },
                        { data: 'sent_net' },
                        { data: 'sent_pos' },
                        { data: 'jumlah' },
                        { data: 'status' },
                    ]
                });
                t.on('order.dt search.dt', function () {
                    t.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
                        cell.innerHTML = i + 1;
                    });
                }).draw();
            }

        $(document).ready( function () {
            //hide all tabs first
            $('.val-content').hide();
            //show the first tab content
            var getValSelectable = $('#search_hasil_olah').val();
            $('#tesload').loading();
            loadtabel(getValSelectable);
            $('#tesload').loading('stop');


            $('#search_hasil_olah').change(function () {
                var dropdown = $('#search_hasil_olah').val();
                //first hide all tabs again when a new option is selected
                $('.val-content').hide();
                //then show the tab content of whatever option value was selected
                $('#'+ dropdown).show();
            });
            // datatable section 
            $('.tabel_hasil').DataTable();
            // show hidden tab
            $('#' + getValSelectable).show();
        } );
    </script>
</body>

</html>