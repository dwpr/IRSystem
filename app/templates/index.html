<!DOCTYPE html>
<html lang="en">

<head>
    {% include "head.html" %}
    <script src="../static/js/lib/echart/echart4/echarts.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="row mt-4 mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <form id="myForm">
                            <div>
                                <label class="mr-sm-2" for="inlineFormCustomSelect">Search</label>
                                <div class="input-group">
                                    <input type="text" class="form-control rounded-0" id="query" name="query"
                                        placeholder="Enter Query" required>
                                    <div class="input-group-prepend">
                                        <button type="submit" id="submitForm" class="btn btn-primary">Submit</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div id="dsd">
                    </div>
                    <div class="card-footer" id="loading">
                        <div id="pesan"></div>
                        <div id="tampilchart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" id="myModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content rounded-0">
                <div class="modal-header rounded-0 bg-primary ">
                    <h5 id="judulModal" class="modal-title text-capitalize text-white"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h7 class="badge badge-success" id="instansiModal" class="modal-title text-capitalize text-white">
                    </h7>
                    <div class="bg-info text-white">
                        <p class="m-2">Judul</p>
                    </div>
                    <div>
                        <p class="pl-2" id="isiModal"></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary rounded-0" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- All Jquery -->
    {% include "script.html" %}
    </script>
    <script>
        //ketika submit button d click
        $("#submitForm").click(function () {
            $("#submitForm").attr("disabled", true);
            var url = '/cosine'; //url
            //do ajax proses
            $.ajax({
                url: url,
                type: "POST", //form method
                data: $("#myForm").serialize(),
                // contentType: 'application/json;charset=UTF-8', # if centnt type json
                contentType: 'application/x-www-form-urlencoded', //encode data content type
                dataType: "json", //misal kita ingin format datanya brupa json
                beforeSend: function () {
                    //lakukan apasaja sambil menunggu proses selesai disini
                    //misal tampilkan loading                   
                    $('#loading').loading({
                        theme: 'dark',
                        message: 'Please wait, maybe this take several time to process'
                    });
                },
                success: function (data) { //or response
                    if (data.error == true) {
                        $('#loading').loading('stop');
                        console.log(data.message);
                        $("#pesan").html(
                            '<div class="alert alert-danger" role="alert"><strong>'+data.message+'</strong></div>'
                        );
                    } else {
                        $('#loading').loading({
                            message: "loading graph"
                        });
                        $('#tampilchart').html(
                            "<div class='mw-100 mh-100' style='width:2000px; height:600px;' id='echartgraph'></div>"
                        );
                        // based on prepared DOM, initialize echarts instance
                        var myChart = echarts.init(document.getElementById('echartgraph'));
                        var dt = data.scatter;
                        var lg = data.lgd;
                        option = {
                            xAxis: {
                                show: false
                            },
                            yAxis: {
                                show: false,
                            },
                            legend: {
                                data: lg,
                            },
                            tooltip: {
                                // position: "top"                                    
                                formatter: function (obj) {
                                    // console.log(obj);
                                    var value = obj.value;
                                    return value[5] + '<br><b>' + value[4] +
                                        '</b><br>Jumlah judul ï¼š' + value[2] +
                                        '<br><b>(click to detail)</b>';
                                }
                            },
                            dataZoom: [{
                                type: 'slider',
                                orient: 'vertical'
                            }],
                            series: dt
                        };
                        myChart.setOption(option);
                        myChart.on('click', 'series', function (obj) {
                            var dt = obj.value[3];
                            $("#judulModal").html(obj.value[5]);
                            $("#instansiModal").html(obj.value[4]);
                            $("#isiModal").html(dt.join('<br><br>'));
                            $('#myModal').modal('show');
                        });
                        window.onresize = function () {
                            myChart.resize();
                        };
                        $('#loading').loading('stop');
                    }
                    $("#submitForm").removeAttr("disabled");
                },
                error: function (xhr, Status, err) {
                    $('#loading').loading('stop');
                    console.log("Something wrong :(");
                    $("#submitForm").removeAttr("disabled");
                    // console.log(err);
                }
            });
            return false;
        });
    </script>
</body>

</html>