<!DOCTYPE html>
<html lang="en">

<head>
    {% include "head.html" %}
    <script src="../static/js/lib/echart/echart4/echarts.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="row mt-4 mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h2 class="h1 text-center text-danger text-capitalize">Information Retrieval</h2>
                    </div>
                    <div class="card-body">
                        <form id="myForm">
                            <div class="input-group">
                                <input type="text" class="form-control rounded-0" id="query" name="query" placeholder="Enter Query" required>
                                <div class="input-group-prepend">
                                    <button type="submit" id="submitForm" class="btn btn-primary">Submit</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div id="dsd"></div>
                    <div class="card-footer" id="loading">
                        <div id="pesan"></div>
                        <div id="tampilchart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- All Jquery -->
    {% include "script.html" %}
    <script>
        $(function () {
            //ketika submit button d click
            $("#submitForm").click(function () {
                $("#submitForm").attr("disabled", true);
                //do ajax proses
                $.ajax({
                    url: "/olah",
                    type: "POST", //form method
                    data: $("#myForm").serialize(),
                    // contentType: 'application/json;charset=UTF-8', # if centnt type json
                    contentType: 'application/x-www-form-urlencoded', //encode data content type
                    dataType: "json", //misal kita ingin format datanya brupa json
                    beforeSend: function () {
                        //lakukan apasaja sambil menunggu proses selesai disini
                        //misal tampilkan loading                   
                        $('#loading').loading(
                            {
                                theme:'dark',
                                message: 'Please wait, maybe this take several time to process'
                            }
                        );
                    },
                    success: function (data) { //or response
                        if (data.error==true){
                            $('#loading').loading('stop');
                            console.log("please input a query");
                            $("#pesan").html('<div class="alert alert-danger" role="alert"><strong>please input a query</strong></div>');
                        }else{                            
                            $('#loading').loading({ message: "loading graph" });
                            // console.log(data.data);
                            // $('#tampilchart').html(data.data);
                            $("#pesan").html('<div class="alert alert-success text-center" role="alert"><strong>Graph yang terbentuk</strong></div>');
                            $('#tampilchart').html("<div class='alert alert-info text-center text-capitalize'>Cosine</div><div class='mw-100 mh-100' style='width:2000px; height:600px;' id='echartgraph'></div><div class='alert alert-info text-center text-capitalize'>Fuzzy Token Set Ratio</div><div class='mw-100 mh-100' style='width:2000px; height:600px;' id='echartgraph2'></div>");
                            // based on prepared DOM, initialize echarts instance
                            var myChart = echarts.init(document.getElementById('echartgraph'));
                            var myChart2 = echarts.init(document.getElementById('echartgraph2'));
                            var dt = data.scatterCos;
                            option = {                              
                                xAxis: {
                                    show: false
                                },
                                yAxis: {
                                    show: false,
                                },
                                tooltip:{
                                    position: "top"
                                },
                                toolbox: {
                                    left: 'center',
                                    top:'top',
                                    feature: {
                                        dataZoom: {
                                            title:{
                                                zoom:"zoom /select data",
                                                back:"reset to normal"
                                            }
                                        }
                                    }
                                },
                                dataZoom: [{
                                    type: 'slider',
                                    orient: 'vertical'
                                }],
                                series:dt
                            };
                            myChart.setOption(option);
                            var dt2 = data.scatterFuzz;
                            option2 = {
                                xAxis: {
                                    show: false
                                },
                                yAxis: {
                                    show: false,
                                },
                                tooltip: {
                                    position: "top"
                                },
                                toolbox: {
                                    left: 'center',
                                    top: 'top',
                                    feature: {
                                        dataZoom: {
                                            title: {
                                                zoom: "zoom /select data",
                                                back: "reset to normal"
                                            }
                                        }
                                    }
                                },
                                dataZoom: [{
                                    type: 'slider',
                                    orient: 'vertical'
                                }],
                                series: dt2
                            };
                            myChart2.setOption(option2);
                            window.onresize = function () {
                                myChart.resize();
                                myChart2.resize();
                            };
                            $('#loading').loading('stop');
                        }                        
                        $("#submitForm").removeAttr("disabled");
                    },
                    error: function (xhr, Status, err) {
                        $('#loading').loading('stop');
                        console.log("Something wrong :(");                        
                        $("#submitForm").removeAttr("disabled");
                        // console.log(err);
                    }
                    }); 
                    return false;
                })
            });
    </script>
</body>

</html>